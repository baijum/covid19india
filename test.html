<!DOCTYPE HTML>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700,700i,800&display=swap" rel="stylesheet">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <link href="style.css" rel="stylesheet">


  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
  
  <style>#map { width: 100%; height: 450px; }
    .info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } .info h4 { margin: 0 0 5px; color: #777; }
    .legend { text-align: left; line-height: 18px; color: #555; } .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }
    </style>
  
  <link rel="icon" type="image/png" href="favicon.png" />
  <meta name="description" content="Live updates of the Coronavirus COVID-19 outbreak in India" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="https://www.covid19india.org" />
  <meta name="twitter:title" content="India COVID-19 Tracker" />
  
  <meta name="twitter:description" content="Live updates of the Coronavirus COVID-19 outbreak in India" />
  <meta property="og:title" content="India COVID-19 Tracker" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.covid19india.org" />
  <meta property="og:description" content="Live updates of the Coronavirus COVID-19 outbreak in India" />
  
</head>

<body>
  <header class="embed-hide">
    <h1>India COVID-19 Tracker</h1>
    <div>
      <em>
        View our <a href="https://docs.google.com/spreadsheets/d/1nzXUdaIWC84QipdVGUKTiCSc5xntBbpMpzLm6Si33zk" target="_blank">live patient database</a>
      </em>
    </div>
    <section id="kpi">
      <div id="kpi-confirmed">
        <!-- <div class="diff">( +19 )</div> -->
        <div class="value" id="confvalue">0</div>
        <div class="label">Confirmed</div>
      </div>
      <div id="kpi-deceased">
        <!-- <div class="diff">( +2 )</div> -->
        <div class="value" id="deathsvalue">0</div>
        <div class="label">Deaths</div>
      </div>
      
      <div id="kpi-recovered">
        <!-- <div class="diff">( +0 )</div> -->
        <div class="value" id="recoveredvalue">0</div>
        <div class="label">Recovered</div>
      </div>
      <div id="kpi-active" data-tippy-content="Tooltip">
        <!-- <div class="diff">( +17 )</div> -->
        <div class="value" id="states-value">0</div>
        <div class="label">States Infected</div>
      </div>
      
    </div>
    
  </section>
  
  <div id='map'></div>

  <section class="embed-hide">
    <h4>State-wise Data</h4>
    <table id="prefectures-table">
    </table>
  </section>
</header>
</body>

<script type="text/javascript" src="india.js"></script>
<script type="text/javascript">
  // var res; 
  
  var alldata = [];
  
  
  var newjson = [];
  
  $.getJSON("https://spreadsheets.google.com/feeds/cells/1nzXUdaIWC84QipdVGUKTiCSc5xntBbpMpzLm6Si33zk/2/public/values?alt=json",
  function(result) {
    entries = result["feed"]["entry"]
    entries.forEach(function(item) {
      if (newjson[(item["gs$cell"]["row"] - 1)] == null) {
        newjson[(item["gs$cell"]["row"] - 1)] = [];
        alldata[(item["gs$cell"]["row"] - 1)] = [];
      }
      if (parseInt(item["gs$cell"]["col"] - 1) < 2) {
        if (!isNaN(item["gs$cell"]["$t"])) {
          newjson[(item["gs$cell"]["row"] - 1)][(item["gs$cell"]["col"] - 1)] = parseInt(item["gs$cell"]["$t"]);
        } else {
          newjson[(item["gs$cell"]["row"] - 1)][(item["gs$cell"]["col"] - 1)] = (item["gs$cell"]["$t"]);
        }
      }
      alldata[(item["gs$cell"]["row"] - 1)][(item["gs$cell"]["col"] - 1)] = (item["gs$cell"]["$t"]);
    });
    // alldata = newjson;
    newjson.splice(1, 1);
    // console.log(newjson);
    // console.log(alldata);
    var numStatesInfected = -1;
    
    var tablehtml = "<thead>";
      for (var i = 0; i < alldata.length; i++) {
        if (i == 0) {
          tablehtml += "<tr>";
            alldata[i].forEach(function(data) {
              tablehtml += "<th>" + data + "</th>";
            });
            tablehtml += "</tr></thead><tbody>";
            } else {
              if (i == 1) {
                continue;
              }
              tempdata = Array.from(alldata[i]);
              
              tempdata.splice(0, 1);
              allzero = true;
              tempdata.forEach(function(data) {
                if (data != 0) {
                  allzero = false;
                }
              });
              if (!allzero) {
                numStatesInfected++;
                tablehtml += "<tr>";
                  alldata[i].forEach(function(data) {
                    tablehtml += "<td>" + data + "</td>";
                  });
                  tablehtml += "</tr>";
                }
              }
            }
            tablehtml += '<tr class="totals">';
              alldata[1].forEach(function(data) {
                tablehtml += "<td>" + data + "</td>";
              });
              tablehtml += "</tr>";
              
              tablehtml += "</tbody>";
              alldata.forEach(function(item) {
                tablehtml += item[0];
              });
              // console.log(numStatesInfected);
              $("table#prefectures-table").html(tablehtml);
              $("div#states-value").html(numStatesInfected);
              $("div#confvalue").html(alldata[1][1]);
              $("div#deathsvalue").html(alldata[1][3]);
              $("div#recoveredvalue").html(alldata[1][2]);
              
              
              
            });
            

            var map = L.map('map').setView([22.5, 82], 4);
            // map.setMaxBounds(map.getBounds());
            
            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                maxZoom: 6,
                minZoom: 4,
                // attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                // '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                // 'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                id: 'mapbox/light-v9',
                tileSize: 512,
                zoomOffset: -1
            }).addTo(map);
            
            
            // control that shows state info on hover
            var info = L.control();
            
            info.onAdd = function (map) {
                this._div = L.DomUtil.create('div', 'info');
                this.update();
                return this._div;
            };
            var yol = 0
            info.update = function (props) {
                if(props){
                // console.log(props);
                this._div.innerHTML = '<h4>Confirmed cases</h4>' + props["NAME_1"];
                }
                yol++;
            };
            
            info.addTo(map);
            
            
            // get color depending on population density value
            function getColor(d) {
                return d > 1000 ? '#800026' :
                d > 500  ? '#BD0026' :
                d > 200  ? '#E31A1C' :
                d > 100  ? '#FC4E2A' :
                d > 50   ? '#FD8D3C' :
                d > 20   ? '#FEB24C' :
                d > 10   ? '#FED976' :
                '#FFEDA0';
            }
            
            function style(feature) {
                console.log(feature.properties);
                return {
                    weight: 2,
                    opacity: 1,
                    color: 'white',
                    dashArray: '3',
                    fillOpacity: 0.1,
                    fillColor: "#FF0000"
                    // fillColor: getColor(feature.properties)
                };
            }
            
            function highlightFeature(e) {
                geojson.resetStyle();
                info.update();

                var layer = e.target;
                
                layer.setStyle({
                    weight: 2,
                    color: '#666',
                    dashArray: '',
                    fillOpacity: 0.7
                });
                
                if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                    layer.bringToFront();
                }
                
                info.update(layer.feature.properties);
            }
            
            var geojson;
            
            function resetHighlight(e) {
                geojson.resetStyle(e.target);
                info.update();
            }
            
            function zoomToFeature(e) {
                map.fitBounds(e.target.getBounds());
            }
            
            function onEachFeature(feature, layer) {
                layer.on({
                    mouseover: highlightFeature,
                    mouseout: resetHighlight,
                    click: highlightFeature
                });
            }
            
            geojson = L.geoJson(statesData, {
                style: style,
                onEachFeature: onEachFeature
            }).addTo(map);
            
          </script>
           
          
          </html>
